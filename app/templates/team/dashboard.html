{% extends "base.html" %} {% block title %}Monitoring Dashboard{% endblock %} {%
block content %}
<div class="bg-green-50 text-gray-800 h-screen overflow-hidden">
  <!-- Mobile Navbar -->
  <div
    class="md:hidden flex justify-between items-center px-4 py-3 bg-white border-b shadow-sm"
  >
    <button onclick="toggleSidebar()" class="text-green-700">
      <i data-lucide="menu" class="w-6 h-6"></i>
    </button>
    <div class="flex items-center gap-2">
      <!-- <a
        class="sheet border rounded-md p-2 text-green-700 pointer-cursor"
        href="/"
        target="_blank"
        rel="noopener noreferrer"
        >Spreadsheet</a
      > -->
      <img
        src="{{ user.picture }}"
        alt="User"
        class="w-9 h-9 rounded-full border object-cover"
      />
    </div>
  </div>

  <!-- Sidebar Overlay (Mobile only) -->
  <div
    id="sidebar-backdrop"
    class="fixed inset-0 bg-black bg-opacity-40 z-20 hidden md:hidden"
    onclick="closeSidebar()"
  ></div>

  <div class="grid grid-cols-1 md:grid-cols-[260px,1fr] h-full w-full">
    <!-- Sidebar -->
    {% include "partials/_fb_sidebar.html" %}

    <!-- Main Content -->
    <main class="relative flex flex-col h-screen overflow-hidden">
      <!-- Sticky Header -->
      {% include "partials/header.html" %}

      <!-- Tab Content -->
      <div id="d-tab-content" class="flex-1 overflow-y-auto p-2 md:p-4"></div>
      <div class="p-10 flex md:hidden"></div>
    </main>
  </div>
</div>

<!-- Enhanced Dashboard Loader -->
<div
  id="dashboard-loader"
  class="hidden absolute inset-0 bg-white bg-opacity-80 z-50 flex flex-col items-center justify-center space-y-6"
>
  <!-- Spinner -->
  <div class="relative w-20 h-20">
    <div
      class="absolute inset-0 rounded-full border-[6px] border-t-green-500 border-gray-300 animate-spin"
    ></div>
    <div class="absolute inset-1 rounded-full bg-white"></div>
    <!-- Sheet Icon Center -->
    <svg
      class="absolute inset-2 w-8 h-8 text-green-500 m-auto"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-6m-6-6l6 6m-6-6v6h6"
      />
    </svg>
  </div>

  <!-- Loading Text -->
  <div class="text-lg text-green-600 font-bold animate-pulse tracking-wide">
    Analyzing spreadsheet data...
  </div>
</div>

<script>
  const buttons = document.querySelectorAll(".tab-btn");
  const tabContents = document.querySelectorAll(".tab-content");
  const sidebar = document.getElementById("sidebar");
  const sidebarBackdrop = document.getElementById("sidebar-backdrop");

  function showTab(tab) {
    const buttons = document.querySelectorAll(".tab-btn");
    const tabContents = document.querySelectorAll(".tab-content");

    buttons.forEach((btn) => {
      btn.classList.remove(
        "text-green-600",
        "font-semibold",
        "border-b-2",
        "border-green-600"
      );
      if (btn.textContent.trim() === tab) {
        btn.classList.add(
          "text-green-600",
          "font-semibold",
          "border-b-2",
          "border-green-600"
        );
      }
    });

    tabContents.forEach((el) => el.classList.add("hidden"));
    const activeTab = document.getElementById(`${tab}-tab`);
    if (activeTab) {
      activeTab.classList.remove("hidden");
      setTimeout(() => {
        document.querySelectorAll("canvas.chart").forEach((canvas) => {
          if (canvas._chartInstance) canvas._chartInstance.resize();
        });
      }, 100);
    }
  }

  function toggleSidebar() {
    sidebar.classList.toggle("-translate-x-full");
    sidebarBackdrop.classList.toggle("hidden");
  }

  function closeSidebar() {
    sidebar.classList.add("-translate-x-full");
    sidebarBackdrop.classList.add("hidden");
  }

  function logout() {
    fetch("/auth/logout", { method: "GET", credentials: "include" }).then(
      () => {
        localStorage.removeItem("google_id_token");
        window.location.href = "/";
      }
    );
  }

  document.addEventListener("DOMContentLoaded", () => {
    if (window.lucide) window.lucide.createIcons();
  })
</script>
{% endblock %}

